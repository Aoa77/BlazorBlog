@*
    <FlexBox /> is a custom component that wraps the <flex-box> element.
*@
@inherits ParentComponent
@inject IJSRuntime JS

<flex-box style="display: @_display;" data-flex="@_flexSizer?.ToJson()">
    @ChildContent
</flex-box>

@code {
    private string _display = DisplayStyle.flex;
    private FlexSizer? _flexSizer = null!;

    [Parameter] public double? MinimumFlexWidth { get; set; }

    protected override void OnInitialized()
    {
        if (MinimumFlexWidth is not null)
        {
            _flexSizer = new() { MinimumFlexWidth = MinimumFlexWidth.Value };
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender)
        {
            return;
        }
        if (_flexSizer is null)
        {
            return;
        }
        var viewWidth = await JS.GetViewWidth();
        if (viewWidth < _flexSizer.MinimumFlexWidth)
        {
            _display = DisplayStyle.block;
            StateHasChanged();
        }
    }
}